"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([[793],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),d=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=d(e.components);return r.createElement(c.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=d(n),m=o,E=u["".concat(c,".").concat(m)]||u[m]||l[m]||a;return n?r.createElement(E,s(s({ref:t},p),{},{components:n})):r.createElement(E,s({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,s=new Array(a);s[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var d=2;d<a;d++)s[d]=n[d];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9218:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return d},toc:function(){return p},default:function(){return u}});var r=n(7462),o=n(3366),a=(n(7294),n(3905)),s=["components"],i={},c="Server Setup",d={unversionedId:"administration/server-setup",id:"administration/server-setup",isDocsHomePage:!1,title:"Server Setup",description:"Installation",source:"@site/docs/30-administration/10-server-setup.md",sourceDirName:"30-administration",slug:"/administration/server-setup",permalink:"/docs/administration/server-setup",editUrl:"https://github.com/woodpecker-ci/woodpecker/edit/master/docs/docs/30-administration/10-server-setup.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Status Badges",permalink:"/docs/usage/badges"},next:{title:"Server configuration",permalink:"/docs/administration/server-config"}},p=[{value:"Installation",id:"installation",children:[]},{value:"Authentication",id:"authentication",children:[]},{value:"Database",id:"database",children:[]},{value:"SSL",id:"ssl",children:[]},{value:"Metrics",id:"metrics",children:[]},{value:"Behind a proxy",id:"behind-a-proxy",children:[]},{value:"Deploy to Kubernetes",id:"deploy-to-kubernetes",children:[]}],l={toc:p};function u(e){var t=e.components,n=(0,o.Z)(e,s);return(0,a.kt)("wrapper",(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"server-setup"},"Server Setup"),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("p",null,"The below ",(0,a.kt)("a",{parentName:"p",href:"https://docs.docker.com/compose/"},"docker-compose")," configuration can be used to start Woodpecker with a single agent."),(0,a.kt)("p",null,"It relies on a number of environment variables that you must set before running ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-compose up"),". The variables are described below."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"# docker-compose.yml\nversion: '3'\n\nservices:\n  woodpecker-server:\n    image: woodpeckerci/woodpecker-server:latest\n    ports:\n      - 8000:8000\n    volumes:\n      - woodpecker-server-data:/var/lib/drone/\n    environment:\n      - WOODPECKER_OPEN=true\n      - WOODPECKER_HOST=${WOODPECKER_HOST}\n      - WOODPECKER_GITHUB=true\n      - WOODPECKER_GITHUB_CLIENT=${WOODPECKER_GITHUB_CLIENT}\n      - WOODPECKER_GITHUB_SECRET=${WOODPECKER_GITHUB_SECRET}\n      - WOODPECKER_SECRET=${WOODPECKER_SECRET}\n\n  woodpecker-agent:\n    image: woodpeckerci/woodpecker-agent:latest\n    command: agent\n    restart: always\n    depends_on:\n      - woodpecker-server\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - WOODPECKER_SERVER=woodpecker-server:9000\n      - WOODPECKER_SECRET=${WOODPECKER_SECRET}\n\nvolumes:\n  woodpecker-server-data:\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Each agent is able to process one build by default."),(0,a.kt)("p",{parentName:"blockquote"},"If you have 4 agents installed and connected to the Woodpecker server, your system will process 4 builds in parallel."),(0,a.kt)("p",{parentName:"blockquote"},"You can add more agents to increase the number of parallel builds or set the agent's ",(0,a.kt)("inlineCode",{parentName:"p"},"WOODPECKER_MAX_PROCS=1")," environment variable to increase the number of parallel builds for that agent.")),(0,a.kt)("p",null,"Woodpecker needs to know its own address."),(0,a.kt)("p",null,"You must therefore provide the address in ",(0,a.kt)("inlineCode",{parentName:"p"},"<scheme>://<hostname>")," format. Please omit trailing slashes."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"services:\n  woodpecker-server:\n    image: woodpeckerci/woodpecker-server:latest\n    environment:\n      - WOODPECKER_OPEN=true\n+     - WOODPECKER_HOST=${WOODPECKER_HOST}\n      - WOODPECKER_GITHUB=true\n      - WOODPECKER_GITHUB_CLIENT=${WOODPECKER_GITHUB_CLIENT}\n      - WOODPECKER_GITHUB_SECRET=${WOODPECKER_GITHUB_SECRET}\n      - WOODPECKER_SECRET=${WOODPECKER_SECRET}\n")),(0,a.kt)("p",null,"Agents require access to the host machine's Docker daemon."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"services:\n  woodpecker-agent:\n    image: woodpeckerci/woodpecker-agent:latest\n    command: agent\n    restart: always\n    depends_on: [ woodpecker-server ]\n+   volumes:\n+     - /var/run/docker.sock:/var/run/docker.sock\n")),(0,a.kt)("p",null,"Agents require the server address for agent-to-server communication."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"services:\n  woodpecker-agent:\n    image: woodpeckerci/woodpecker-agent:latest\n    command: agent\n    restart: always\n    depends_on: [ woodpecker-server ]\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n+     - WOODPECKER_SERVER=woodpecker-server:9000\n      - WOODPECKER_SECRET=${WOODPECKER_SECRET}\n")),(0,a.kt)("p",null,"The server and agents use a shared secret to authenticate communication."),(0,a.kt)("p",null,"This should be a random string of your choosing and should be kept private. You can generate such string with ",(0,a.kt)("inlineCode",{parentName:"p"},"openssl rand -hex 32"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"services:\n  woodpecker-server:\n    image: woodpeckerci/woodpecker-server:latest\n    environment:\n      - WOODPECKER_OPEN=true\n      - WOODPECKER_HOST=${WOODPECKER_HOST}\n      - WOODPECKER_GITHUB=true\n      - WOODPECKER_GITHUB_CLIENT=${WOODPECKER_GITHUB_CLIENT}\n      - WOODPECKER_GITHUB_SECRET=${WOODPECKER_GITHUB_SECRET}\n+     - WOODPECKER_SECRET=${WOODPECKER_SECRET}\n  woodpecker-agent:\n    image: woodpeckerci/woodpecker-agent:latest\n    environment:\n      - WOODPECKER_SERVER=woodpecker-server:9000\n      - WOODPECKER_DEBUG=true\n+     - WOODPECKER_SECRET=${WOODPECKER_SECRET}\n")),(0,a.kt)("h2",{id:"authentication"},"Authentication"),(0,a.kt)("p",null,"Authentication is done using OAuth and is delegated to one of multiple version control providers, configured using environment variables. The example above demonstrates basic GitHub integration."),(0,a.kt)("p",null,"See the complete reference for ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/vcs/github"},"GitHub"),", ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/vcs/bitbucket"},"Bitbucket Cloud"),", ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/vcs/bitbucket_server"},"Bitbucket Server")," and ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/vcs/gitlab"},"Gitlab"),"."),(0,a.kt)("h2",{id:"database"},"Database"),(0,a.kt)("p",null,"Woodpecker mounts a ",(0,a.kt)("a",{parentName:"p",href:"https://docs.docker.com/storage/volumes/#create-and-manage-volumes"},"data volume")," to persist the sqlite database."),(0,a.kt)("p",null,"See the ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/database"},"database settings")," page to configure Postgresql or MySQL as database."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-diff"},"services:\n  woodpecker-server:\n    image: woodpeckerci/woodpecker-server:latest\n    ports:\n      - 80:8000\n      - 9000\n+   volumes:\n+     - woodpecker-server-data:/var/lib/drone/\n    restart: always\n")),(0,a.kt)("h2",{id:"ssl"},"SSL"),(0,a.kt)("p",null,"Woodpecker supports ssl configuration by mounting certificates into your container. See the ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/ssl"},"SSL guide"),"."),(0,a.kt)("p",null,"Automated ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/lets-encrypt"},"Lets Encrypt")," is also supported."),(0,a.kt)("h2",{id:"metrics"},"Metrics"),(0,a.kt)("p",null,"A ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/prometheus"},"Prometheus endpoint")," is exposed."),(0,a.kt)("h2",{id:"behind-a-proxy"},"Behind a proxy"),(0,a.kt)("p",null,"See the ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/proxy"},"proxy guide")," if you want to see a setup behind Apache, Nginx, Caddy or ngrok."),(0,a.kt)("h2",{id:"deploy-to-kubernetes"},"Deploy to Kubernetes"),(0,a.kt)("p",null,"See the ",(0,a.kt)("a",{parentName:"p",href:"/docs/administration/kubernetes"},"Kubernetes guide")," if you want to deploy Woodpecker to your Kubernetes cluster."))}u.isMDXComponent=!0}}]);