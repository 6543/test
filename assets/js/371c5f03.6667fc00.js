"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([[3150],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return m}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),s=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=s(e.components);return r.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=s(t),m=a,f=d["".concat(c,".").concat(m)]||d[m]||u[m]||o;return t?r.createElement(f,i(i({ref:n},p),{},{components:t})):r.createElement(f,i({ref:n},p))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=d;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},259:function(e,n,t){t.r(n),t.d(n,{assets:function(){return h},contentTitle:function(){return m},default:function(){return g},frontMatter:function(){return d},metadata:function(){return f},toc:function(){return k}});var r=t(3905),a=Object.defineProperty,o=Object.defineProperties,i=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,p=(e,n,t)=>n in e?a(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,u=(e,n)=>{for(var t in n||(n={}))c.call(n,t)&&p(e,t,n[t]);if(l)for(var t of l(n))s.call(n,t)&&p(e,t,n[t]);return e};const d={},m="Local backend",f={unversionedId:"administration/backends/local",id:"administration/backends/local",title:"Local backend",description:"The local backend will execute the pipelines on the local system without any isolation of any kind.",source:"@site/docs/30-administration/22-backends/20-local.md",sourceDirName:"30-administration/22-backends",slug:"/administration/backends/local",permalink:"/docs/next/administration/backends/local",draft:!1,editUrl:"https://github.com/woodpecker-ci/woodpecker/edit/master/docs/docs/30-administration/22-backends/20-local.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Docker backend",permalink:"/docs/next/administration/backends/docker"},next:{title:"SSH backend",permalink:"/docs/next/administration/backends/ssh"}},h={},k=[{value:"Configuration",id:"configuration",level:2},{value:"Server",id:"server",level:3},{value:"Agent",id:"agent",level:3},{value:"Running the agent",id:"running-the-agent",level:2},{value:"Further configuration",id:"further-configuration",level:2},{value:"Specify the shell to be used for a pipeline step",id:"specify-the-shell-to-be-used-for-a-pipeline-step",level:3},{value:"Using labels to filter tasks",id:"using-labels-to-filter-tasks",level:3}],b={toc:k};function g(e){var n,t=e,{components:a}=t,p=((e,n)=>{var t={};for(var r in e)c.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&l)for(var r of l(e))n.indexOf(r)<0&&s.call(e,r)&&(t[r]=e[r]);return t})(t,["components"]);return(0,r.kt)("wrapper",(n=u(u({},b),p),o(n,i({components:a,mdxType:"MDXLayout"}))),(0,r.kt)("h1",u({},{id:"local-backend"}),"Local backend"),(0,r.kt)("admonition",u({},{type:"danger"}),(0,r.kt)("p",{parentName:"admonition"},"The local backend will execute the pipelines on the local system without any isolation of any kind.")),(0,r.kt)("admonition",u({},{type:"note"}),(0,r.kt)("p",{parentName:"admonition"},"This backend is still pretty new and can not be treated as stable. Its\nimplementation and configuration can change at any time. Binary releases of the\nagent will be available with the release of the ",(0,r.kt)("a",u({parentName:"p"},{href:"https://github.com/woodpecker-ci/woodpecker/milestone/4"}),"1.0.0\nmilestone"),", so for now\nyou must compile the agent by yourself, to get the local backend functionality.")),(0,r.kt)("p",null,"Since the code runs directly in the same context as the agent (same user, same\nfilesystem), a malicious pipeline could be used to access the agent\nconfiguration especially the ",(0,r.kt)("inlineCode",{parentName:"p"},"WOODPECKER_AGENT_SECRET")," variable."),(0,r.kt)("p",null,"It is recommended to use this backend only for private setup where the code and\npipeline can be trusted. You shouldn't use it for a public facing CI where\nanyone can submit code or add new repositories. You shouldn't execute the agent\nas a privileged user (root)."),(0,r.kt)("p",null,"The local backend will use a random directory in $TMPDIR to store the cloned\ncode and execute commands."),(0,r.kt)("p",null,"In order to use this backend, you need to download (or build) the\n",(0,r.kt)("a",u({parentName:"p"},{href:"https://github.com/woodpecker-ci/woodpecker/releases/latest"}),"binary")," of the\nagent, configure it and run it on the host machine."),(0,r.kt)("h2",u({},{id:"configuration"}),"Configuration"),(0,r.kt)("h3",u({},{id:"server"}),"Server"),(0,r.kt)("p",null,"Enable connection to the server from the outside of the docker environment by\nexposing the port 9000:"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-yaml"}),"# docker-compose.yml for the server\nversion: '3'\n\nservices:\n  woodpecker-server:\n  [...]\n    ports:\n      - 9000:9000\n      [...]\n    environment:\n      - [...]\n")),(0,r.kt)("h3",u({},{id:"agent"}),"Agent"),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file to store environmental variables for configuration.\nAt the minimum you need the following information:"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ini"}),"# .env for the agent\nWOODPECKER_AGENT_SECRET=replace_with_your_server_secret\nWOODPECKER_SERVER=replace_with_your_server_address:9000\n")),(0,r.kt)("h2",u({},{id:"running-the-agent"}),"Running the agent"),(0,r.kt)("p",null,"Start the agent from the directory with the ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file: "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"woodpecker-agent")),(0,r.kt)("admonition",u({},{type:"note"}),(0,r.kt)("p",{parentName:"admonition"},"When using the ",(0,r.kt)("inlineCode",{parentName:"p"},"local")," backend, the\n",(0,r.kt)("a",u({parentName:"p"},{href:"https://github.com/woodpecker-ci/plugin-git"}),"plugin-git")," binary must be in\nyour ",(0,r.kt)("inlineCode",{parentName:"p"},"$PATH")," for the default clone step to work. If not, you can still write a\nmanual clone step.")),(0,r.kt)("h2",u({},{id:"further-configuration"}),"Further configuration"),(0,r.kt)("h3",u({},{id:"specify-the-shell-to-be-used-for-a-pipeline-step"}),"Specify the shell to be used for a pipeline step"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"image")," entry is used to specify the shell, such as Bash or Fish, that is\nused to run the commands."),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-yaml"}),"# .woodpecker.yml\n\npipeline:\n  build:\n    image: bash\n    commands:\n      [...]\n")),(0,r.kt)("h3",u({},{id:"using-labels-to-filter-tasks"}),"Using labels to filter tasks"),(0,r.kt)("p",null,"You can use the ",(0,r.kt)("a",u({parentName:"p"},{href:"/docs/next/administration/agent-config#woodpecker_filter_labels"}),"agent configuration\noptions")," and the\n",(0,r.kt)("a",u({parentName:"p"},{href:"/docs/next/usage/pipeline-syntax#labels"}),"pipeline syntax")," to only run certain\npipelines on certain agents. Example:"),(0,r.kt)("p",null,"Define a ",(0,r.kt)("inlineCode",{parentName:"p"},"label")," ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," with value ",(0,r.kt)("inlineCode",{parentName:"p"},"exec")," for a particular agent:"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-ini"}),"# .env for the agent\n\nWOODPECKER_FILTER_LABELS=type=exec\n")),(0,r.kt)("p",null,"Then, use this ",(0,r.kt)("inlineCode",{parentName:"p"},"label")," ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," with value ",(0,r.kt)("inlineCode",{parentName:"p"},"exec")," in the pipeline definition, to\nonly run on this agent:"),(0,r.kt)("pre",null,(0,r.kt)("code",u({parentName:"pre"},{className:"language-yaml"}),"# .woodpecker.yml\n\nlabels:\n  type: exec\n\npipeline:\n  [...]\n")))}g.isMDXComponent=!0}}]);